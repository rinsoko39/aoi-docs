# 3.5 函数式编程

Aoi 中，运算符是一等公民，运算符可以被作为值传递，包括 `+` `-` 等基本运算符。

## 运算符类型

`LhsType <> RhsType -> ResultType` 表示一个二元运算符类型，`RhsType -> ResultType` 表示一个一元运算符类型，这和运算符定义时是一致的。

例如：

```aoi
op array convert[T, TRes] converter: arr[T] <> (T -> T) -> arr[T] {
    for i in 0..array.length do {
        array.[i] = converter array.[i];
    }
    array
}
```

`convert` 运算符接收一个数组和一个运算符，并将运算符作用于原数组的所有元素。

## 闭包

以下语法定义了一个闭包：

```aoi
lhs: LhsType <> rhs: RhsType => expression
```

```aoi
rhs: RhsType => expression
```

其中，`lhs` `rhs` 是两个声明模式，`expression` 是函数体，`LhsType` `RhsType` 是参数类型，若能自动推导，`: Type` 可以省略。

例如：

```aoi
array convert (a => -a);
```

它将一个数组的所有元素取相反数。

## 二元运算符的柯里化

二元运算符可以不提供左侧的值而当作一元运算符使用，它的结果是一个一元运算符，它接收未提供的左侧的值作为参数，返回最终结果。即，`op a` 等价于 `x => x op a`。

例如：

```aoi
array convert ((+) 42)
```

它将加法运算柯里化，`(+) 42` 是一个一元运算符，会返回传入的值加 `42` 后的结果。加号周围加了括号以防止被识别为正号。以上代码将数组所有元素加 `42`。

## 管道运算符

管道运算符 `|>` 连接一个值和一个接收该值的一元运算符，并返回运算符作用于值的结果。它将值与运算符的顺序反转，并且由于其为左结合的，链式使用时从前到后依次为调用顺序。

结合二元运算符的柯里化，管道运算符能很好地实现链式调用。

例如：

```aoi
array
    |> convert ((+) 42)
    |> convert (a => if a >= 0 then a else -a)
    |> printLine;
```

以上代码将数组的每一个元素加 `42` 后取绝对值，最后将数组打印。
