# 4.6 动态类型

动态类型是实现多态的核心。对于一个动态类型，我们不关心它是什么，只关心它能做什么。这在 Aoi 中就是没有明确的实类型，只提供关于这个类型的特征的实现。

动态类型形如 `dyn[T0, T1, ...: Trait0[...], Trait1[...], ...] Type`，其中 `Type` 是一个类型，可以使用前面的泛型参数表示该类型的形式。例如，`dyn[T: ToStr[T]] T` 能表示所有实现 `ToStr[T]` 的 `T`，即可以转换为字符串的对象。对于该类型的对象，虽然不知道它的实际类型，但是知道它能转换成字符串。

动态类型本质上是一个存储原始值的指针和若干存储特征实现的虚表。因此，构造一个动态类型需要一个值和若干特征的实现。用 `value[Impl0, Impl1, ...]` 可以表示一个动态类型，其中 `value` 是原始值，`Impl` 是特征的实现。其中，若实现为默认实现，则可以省略，若全为默认实现，则中括号可以省略，该值可以隐式转换成动态类型。

使用动态类型的特征实现中的运算符和使用默认实现中的运算符一样，可以隐式地指定或用特征显式地指定。由于同一个动态类型的不中值中泛型的实际类型是不同的，要使用动态类型的泛型类型，使用 `value::T`，其中 `value` 是动态类型的一个值，`T` 是动态类型中的一个参数。

例如：

```aoi
op print array: arr[dyn[T: ToStr] T] -> () {
    for element in array do {
        printLine toStr element;
    }
}
```

以上代码依次打印数组中的各元素。由于是动态类型，数组中每个元素都可能拥有不同的实类型，但是它们都实现了 `ToStr`，因此可以将它们统一打印。
